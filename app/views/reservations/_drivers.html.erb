<%= form_with model: [@reservation], class: "contents",
  data: { controller: "driver",
          target: "form",
          action: "submit->driver#submitForm"
        } do |form| %>

  <% if @reservation.errors.any? %>
    <div id="error_explanation" class="text-red-umred px-3 py-2 font-medium rounded-lg mt-3">
      <h2><%= pluralize(@reservation.errors.count, "error") %> prohibited this reservation from being saved:</h2>
      <ul>
        <% @reservation.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <p class="body-sm-text">
    Number of People on the Trip - <%= @reservation.number_of_people_on_trip %>
  </p>
  <input type="hidden" id="number_of_people_on_trip" name="number_of_people_on_trip" value=<%= @reservation.number_of_people_on_trip %> data-driver-target="number_of_people_on_trip">
  <% if @reservation.passengers.present? %>
    <p class="body-sm-text">
      The reservation has <%= pluralize(@reservation.passengers.count, 'passenger') %> already
    </p>
  <% end %>
  <input type="hidden" id="number_of_passengers" name="number_of_passengers" value=<%= @reservation.passengers.count %> data-driver-target="number_of_passengers">



    <% if is_student?(current_user) || is_manager?(current_user) %>
      <div class="mt-2">
        <label class="body-lg-bold-text">
          Driver:
        </label>
        <p class="body-lg-text ml-2 inline-block">
          <%= show_driver(@reservation) %>
        </p>
      </div>
      <% if is_student?(current_user) %>
        <input type="hidden" name="reservation[driver_id]" id="reservation_driver_id" value=<%= @reservation.driver_id %> data-driver-target="driver">
      <% end %>
      <% if is_manager?(current_user) %>
        <input type="hidden" name="reservation[driver_manager_id]" id="reservation_driver_manager_id" value=<%= @reservation.driver_manager_id %> data-driver-target="driver">
      <% end %>
    <% else %>
      <% if @reservation.driver_manager.present? %>
        <div class="mt-2">
          <label class="body-lg-bold-text">
            Driver:
          </label>
          <p class="body-lg-text ml-2 inline-block">
            <%= @reservation.driver_manager.display_name + " (manager)" %>
          </p>
        </div>
        <input type="hidden" name="reservation[driver_manager_id]" id="reservation_driver_manager_id" value=<%= @reservation.driver_manager_id %> data-driver-target="driver">
      <% else %>
        <div class="my-5">
          <%= form.label :driver_id, "Driver *", class: "fancy_label" %>
          <%= form.collection_select :driver_id, @drivers, :id, :display_name, { include_blank: "Select ..." }, class: "input_text_field",
            "data-driver-target": "driver" %>
        </div>
      <% end %>
    <% end %>
  

  <div class="error_text" id="driver_error">
  </div>

  <div class="my-5">
    <%= form.label :driver_phone, "Driver's Phone *", class: "fancy_label" %>
    <%= form.text_field :driver_phone, placeholder: "XXX-XXX-XXXX", class: "input_text_field",
      "data-driver-target": "driver_phone" %>
  </div>

  <% if @reservation.number_of_people_on_trip > 1 %>
    <div class="my-5">
      <%= form.label :backup_driver_id, "Backup Driver", class: "fancy_label" %>
      <%= form.collection_select :backup_driver_id, @drivers, :id, :display_name, { include_blank: "Select ..." }, class: "input_text_field",
        "data-driver-target": "backup_driver" %>
    </div>

    <div class="error_text" id="backup_driver_error">
    </div>

    <div>
      <p class="body-sm-bold-text">
        If a Backup Driver is selected the Backup Driver Phone is required
      </p>
    </div>

    <div class="my-5">
      <%= form.label :backup_driver_phone, "Backup Driver Phone", class: "fancy_label" %>
      <%= form.text_field :backup_driver_phone, placeholder: "XXX-XXX-XXXX", class: "input_text_field",
        "data-driver-target": "backup_driver_phone" %>
    </div>
  <% end %>

  <input type="hidden" id="edit" name="edit" value=<%= params[:edit] %>>

  <div class="md:flex items-center whitespace-nowrap">
    <% if params["edit"] == "true" %>
      <div>
        <%= form.submit "Update Drivers", form_class: "flex", class: "primary_button" %>
      </div>
    <% else %>
      <div>
        <%= form.submit "Save and Add Passengers", class: "primary_button" %>
      </div>
    <% end %>
    <div>
      <% if params["edit"] == "true" %>
        <%= link_to reservation_path(@reservation) do %>
          <span class="tertiary_button">Cancel
            <i class="fa fa-times" aria-hidden="true"></i>
          </span>
        <% end %>
      <% end %>
      <% if is_admin?(current_user) && params["edit"] != "true" %>
        <%= link_to reservation_path(@reservation) do %>
          <span class="tertiary_button">Add Drivers Later
            <i class="fa fa-times" aria-hidden="true"></i>
          </span>
        <% end %>
      <% end %>
    </div>
  </div>

<% end %>
